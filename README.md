# cimaq_memory

###### Overview of the different directories' content and purpose

###### NOTE: Refer to each directory's readme.txt for scripts & files description.

## cimaq_convert_eprime_to_bids_event.py
##### Description
- Converts eprime .txt output files into .tsv "event" files
- Compatible with Nistats/Nilearn (to label fMRI frames based on condition (encoding vs control task) and task performance
  - E.g.: Subsequent recognition of image and its on-screen position
 - NOTE: Data to test the script can be found here:
https://www.dropbox.com/sh/1ijtytsqu3zghec/AAAnzupem2TA45EGyW9QpuH9a?dl=0

##### Parameters
##### - d
- Path to directory containing a series of zipped folders
  - Will be under
  /cimaq_memory/data/TaskFiles/ziped_eprime)
- Contains one zipped directory per participant
  - Format = pscid_dccid_Tache_IRM.zip
- Each containing 3 .txt files generated by eprime at time of testing:
###### - Onset-Event-Encoding_CIMAQ_*.txt
###### - Output_Retrieval_CIMAQ_*.txt
###### - Output-Responses-Encoding_CIMAQ*.txt
###### Note: one zip file is included in Dropbox to test the script:
https://www.dropbox.com/sh/1ijtytsqu3zghec/AAAnzupem2TA45EGyW9QpuH9a?dl=0

##### - o
- path to directory where to save output files

##### Return
- Two .tsv files per participant (saved under /cimaq_memory/TaskFiles/Processed):
#####
1. sub- ** -ses-4_task-memory_events.tsv (** = dccid)
  - Create event files in Nistats/Nilearn (to label fMRI frames)
2. PostScanBehav_pscid *_dccid**.tsv ( * = pscid, ** = dccid)
  - Single participant's post-scan memory task performance (image & source recognition)

#### Saved in cimaq_memory/data/TaskFiles/Processed

##### - Note: TaskFile_headers_CIMAQ_memory.json & PostScanBehav_CIMAQ_memory.json describe metrics saved in each column of respectively names tsv files
##### - Note2: Both headers description json files are in data/TaskFiles

## extract_features directory (WIP)

#### cimaq_getbetas.py
- Produces brain maps of beta weights; each map reflects the modeling of the hemodynamic response (spm model; in Nistats) for a single trial.

#### CIMAQ_getBetaMaps.ipynb
- Jupyter notebook detailing how to compute beta maps, using a single participant as an example.

#### CIMAQ_getNetworkFeatures.ipynb
- Jupyter notebook detailing how to compute network activation features, using a single participant as example.

## models directory (WIP)

#### CIMAQ_wholeBrainSVM.ipynb
- Jupyter notebook where an SVM is trained to classify among trials from the cimaq
  - E.g.: Encoding vs control task using all brain voxels

## subject_details directory

#### - 2 header description .json files (to be saved on Stark):
#### MainParticipantFile_headers.json
- Describes main cimaq participant data table's headers
  - Saved in cimaq_memory/data/Participant directory (BIDS)

#### MemoTaskParticipantFile_headers.json
- Describes data found in each column of SubjectList.tsv
  - Subject data table specific to cimaq fMRI memory task
    - One line per participant
  - Saved in cimaq_memory/data/Participants)

### - 3 scripts:

### TaskBehavAnalyses.py
#### Description
- Extracts subject-specific memory performance metrics
  - E.g.: Hits-FA, dprime) from single-subject Post*.tsv files produced by cimaq_convert_eprime_to_bids_event.py
-  Save in single table with 1 row per subject.

#### Parameters
#### - d (Default = cimaq_memory/TaskFiles/Processed)
- Path to directory containing a series of Post*.tsv files
######  - Output of cimaq_convert_eprime_to_bids_event.py

### - o
  - Path to output directory where output files will be saved
####  - Eventually /cimaq_memory/Participants

  - Note: 3 Post*.tsv files are in Dropbox to test the script
  https://www.dropbox.com/sh/92rztaa42bfr5m4/AADK6ACkCf33Ri_1o_vr4xNTa?dl=0

### ExtractMotionInfo.py
#### Description
- Compiles a single .tsv table (all subjects) of motion parameters
  - E.g.: Mean motion in 6 regressed-out directions, number of scrubbed frames from *confounds.tsv files outputed by NIAK
#####  - Found under resample directory

#### Parameters
###   - d
  - path to directory containing *confounds.tsv outputed by NIAK during preprocessing
####  - Found in resample directory

### - o (default=CIMAQ_fmri_memory/data/participants/MotionResults)
- path to output directory where output file is saved
- Note: 3 *confounds.tsv are in Dropbox to test the script
https://www.dropbox.com/sh/7japgtb6a64qk7n/AAB4M9e1aOFgCVD1-iI0e8cSa?dl=0

#### Return
#### - fMRI_meanMotion.tsv
  - Single table for all participants containing motion metrics
    - Mean motion in all 6 regressed-out coordinates, number of scrubbed frames

###### NOTE: Data to test the script can be found here:
https://www.dropbox.com/sh/7japgtb6a64qk7n/AAB4M9e1aOFgCVD1-iI0e8cSa?dl=0

#### MakeMotionFiles_fromMat.py (obsolete)
 - Unused/Obsolete: extracted confounds from .tsv instead, not from .mat files anymore

1. Takes extra.mat files created by NIAK during pre-processing
2. Creates .tsv motion files that can be regressed out of models in Nistats/Nilearn
3. Generates motion metrics table (1 row per participant)
  - E.g., mean motion along 6 axes, total number of scrubbed frames
